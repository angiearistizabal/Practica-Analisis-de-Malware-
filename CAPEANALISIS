Datos generales :
Nombre:  87658a3c5cd72eddc1f3c52b
Tipo:    PE32 executable 
Tamaño:  982528 bytes
-----------------------------------HASH--------------------------------

MD5:   4d41b282814b01eb1cc3198951f6e6c1
SHA1:  d9b039e7517b7577b2adbb0f3d840bf788371ace
SHA256:87658a3c5cd72eddc1f3c52b489ed43e59a0d044c849f300e0f7537568e0502f (EN VIRUS TOTAL)
SHA3-384:b63ec2fdfa915a980bffef4f94314a258bf0e8bcc7b5dee171d92d1d59e25ff5424e6ae3800de84613edb8b1f56f1f76

-------------------REGLAS YARA-----------------------------------------


* INDICATOR_SUSPICIOUS_EXE_UACBypass_CMSTPCOM - Detects Windows exceutables bypassing UAC using CMSTP COM interfaces. MITRE (T1218.003) - Author: ditekSHen
* shellcode_stack_strings - Match x86 that appears to be stack string creation. - Author: William Ballenthin

---------------------ESTRUCTURA PE-------------------------------------

Obtenemos  tres cabeceras:
 - .text
 - .data
 - -idata
 
 Ninguno con con entropía alta, la más alta sería de 6.79
 
 -------------------LIBRERIAS-----------------------------------------
 • 0x4fa02c PathAppendW         : Método para agregar temporalmente una ruta
 • 0x4fa018 CreateProcessW      : Crea procesos
 • 0x4fa01c GetSystemTime       : Método anti sandbox
 • 0x4fa024 LocalFree           :
 • 0x4fa00c CheckTokenMembership: Revisa los privilegios del usuario
 • 0x4fa010 CreateWellKnownSid  : Crea identificadores de seguridad conocidos
 • 0x4fa038 CoSetProxyBlanket   : seguramente busca configurar la manta de seguridad que se aplica a los servidores proxy 

---------------------SRINGS-----------------------------------------------
- idata : Importa datos
SHLWAPI.dll ADVAPI32.dll   ??
ACTIVEDS.dll ole32.dll     ??

- \Registry\Machine\Software\Classes\Lockbit
- \Registry\Machine\Software\Classes\Lockbit\shell\Open\Command

- Elevation:Administrator!new: ---> Busca elevar privilegios

NOTA DE RESCATE : 
All your files stolen and encrypted
for more information see
RESTORE-MY-FILES.TXT
that is located in every encrypted folder.
Would you like to earn millions of dollars?
Our company acquire access to networks of various companies, as well as insider information that can help you steal the most valuable data of any company.
You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc. Open our letter at your email. Launch the provided virus on any computer in your company.
Companies pay us the foreclosure for the decryption of files and prevention of data leak.
You can communicate with us through the Tox messenger
https://tox.chat/download.html
Using Tox messenger, we will never know your real name, it means your privacy is guaranteed.
If you want to contact us, use ToxID: 3085B89A0C515D2FB124D645906F5D3DA5CB97CEBEA975959AE4F95302A04E1D709C3C4AE9B7
If this contact is expired, and we do not respond you, look for the relevant contact data on our website via Tor or Brave Browser
http://lockbitapt6vx57t3eeqjofwgcglmutr3a35nygvokja5uuccip4ykyd.onion
https://bigblog.at

INHABILITA ANTIVIRUS: 

[Software\Policies\Microsoft\Windows Defender
;DisableAntiSpyware

][Software\Policies\Microsoft\Windows Defender\Real-Time Protection
;DisableRealtimeMonitoring

][Software\Policies\Microsoft\Windows Defender\Spynet
;SubmitSamplesConsent

][Software\Policies\Microsoft\Windows Defender\Threats
;Threats_ThreatSeverityDefaultAction

-------------

\Registry\Machine\Software\Classes\Lockbit\shell\Open\Command
"C:\Windows\system32\mshta.exe" "%s"  ---------> EJECUTABLE?

--------------------------------MITRE------------------------------------
T1057 - Descubre procedimientos -> Enumera e insiste en procesos
T1059 - Comandos y scripts -> bcdedit_command ->  herramienta para editar la configuración de arranque de Windows Vista y versiones posteriores de Windows
T1070 - Borra logs 
T1112 - Modifica registros -> persistencia (autorun)
T1202 - Ejecución de comandos indirectos -> seguramente para eludir restricciones de seguridad al momento de ejecutar comandos-> usa utilidades de windows
T1564 - Esconde artefactos -> seguramente para ejecutar cosas de forma oculta
T1071 - Conexiones de red 
T1074 - "Datos organizados" -> echando mano en la papelera
T1485 -Borra logs 
T1486 - Encripta datos -> los datos del ransomware
T1490 -Inhabilita la recuperación del sistema -> persistencia
T1547 - Persistencia a reinicio automatico

--------------------------------SIGNATURES------------------------------
1.Método antisandbox -> anti-debug
2.Método antisandbox por medio de los adaptadores de red
3.Detectado por una regla YARA -> 
Hit: PID 2108 trigged the Yara rule 'INDICATOR_SUSPICIOUS_GENRansomware'
4.Método antisandbox viendo la hora local 
5.Intenta conectarse a muchas IP muertas 510 veces
6.Importacion de librerias al momento de la ejecución 
7.Enumera procesos: 
conhost.exe -> el proceso de un programa (criptominero) que está diseñado para minar la criptomoneda Monero.
msiexec.exe -> Proporciona los medios para instalar, modificar y realizar operaciones en Windows Installer desde la línea de comandos.
dllhost.exe ->  está diseñado para forzar la apertura de páginas web no confiables, engañosos y maliciosos
 Rundll32.exe -> objetivo de hackers que buscan esconder varias infecciones de ordenador como spywares, keyloggers, troyanos y otras dentro del sistema
8.Expresa interes en ciertos procesos
9.Manipula datos de la papelera -> se da los permisos. Pasa por las siguientes rutas : 
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$I44QTP5.py
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$INB7KZ3.pub
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\desktop.ini
10.Proceso en ventana oculta: 
87658a3c5cd72eddc1f3c52b.exe -> cmd.exe
borra backups, shadow copies
/c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no'
 '/c wevtutil cl system
11.Intenta esconderse del depurador
-ThreadHideFromDebugger --> cualquier excepción omitirá el depurador y presionará SEH o explotará y bloqueará la aplicación
12.Crea una memoriia RWX
13.Hace uso de las utilidades de windows:
borra los backups ->C:\Windows\System32\cmd.exe" /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no
cmd.exe /c vssadmin Delete Shadows /All /Quiet
cmd.exe /c wmic SHADOWCOPY /nointeractive
: bcdedit /set {default} bootstatuspolicy ignoreallfailures --> obligará al sistema a arrancar normalmente, en lugar de en el Entorno de recuperación de Windows

14.Modifica la configuración de boot (persistencia)
15.Se autoinstala para hacer autorun en el equipo (persistencia)
16.Regla yara que identifica el tipo de malware : Lockbit: [{'Yara': '87658a3c5cd72eddc1f3c52b489ed43e59a0d044c849f300e0f7537568e0502f'}]
17.Borra eventos y logs de Windows
18.Intenta borrar o modificar el volumen de las shadow copies
19.Crea instrucciones para desencriptar el ransomware "LockBIt"
20.Usa comandos maliciosos y utilidades de Windows
--------------------------------HOST--------------------------------
No detectados
--------------------------------DNS--------------------------------
No detectados 
----------------------------------------------------------------
Ficheros modificados:
A entrado a todas las aplicaciones robando los datos y dejando una nota de como restaurar los archivos
 C:\program files\microsoft games\FreeCell\es-ES\Restore-My-Files.txt
 C:\program files\microsoft games\Hearts\es-ES\Restore-My-Files.txt
 C:\program files\microsoft office\Office14\3082\Restore-My-Files.txt
 C:\program files\mozilla firefox\browser\features\Restore-My-Files.txt
 C:\program files\mozilla firefox\gmp-clearkey\0.1\Restore-My-Files.txt
 
 Desinstala explorador: 
 C:\program files\mozilla firefox\uninstall\uninstall.log
 Antisandbox revisando hora: 
  C:\program files\windows sidebar\Gadgets\clock.gadget\es-ES\js\timezones.js
 --------------------------------Key Registers--------------------------
 
 
 --------------------------PAGINA WEB VIRUS TOTAL ----------------------
 
 
 
