Datos generales :
Nombre:  87658a3c5cd72eddc1f3c52b
Tipo:    PE32 executable 
Tamaño:  982528 bytes
TIempo del PE: 2021-07-26 07:34:01
-----------------------------------HASH--------------------------------

MD5:   4d41b282814b01eb1cc3198951f6e6c1
SHA1:  d9b039e7517b7577b2adbb0f3d840bf788371ace
SHA256:87658a3c5cd72eddc1f3c52b489ed43e59a0d044c849f300e0f7537568e0502f (EN VIRUS TOTAL)
SHA3-384:b63ec2fdfa915a980bffef4f94314a258bf0e8bcc7b5dee171d92d1d59e25ff5424e6ae3800de84613edb8b1f56f1f76

-------------------REGLAS YARA-----------------------------------------


* INDICATOR_SUSPICIOUS_EXE_UACBypass_CMSTPCOM - Detects Windows exceutables bypassing UAC using CMSTP COM interfaces. MITRE (T1218.003) - Author: ditekSHen
* shellcode_stack_strings - Match x86 that appears to be stack string creation. - Author: William Ballenthin

---------------------ESTRUCTURA PE-------------------------------------

Obtenemos  tres cabeceras:
 - .text
 - .data
 - -idata
 
 Ninguno con con entropía alta, la más alta sería de 6.79
 
 -------------------LIBRERIAS-----------------------------------------
 • 0x4fa02c PathAppendW         : Método para agregar temporalmente una ruta
 • 0x4fa018 CreateProcessW      : Crea procesos
 • 0x4fa01c GetSystemTime       : Método anti sandbox
 • 0x4fa024 LocalFree           :
 • 0x4fa00c CheckTokenMembership: Revisa los privilegios del usuario
 • 0x4fa010 CreateWellKnownSid  : Crea identificadores de seguridad conocidos
 • 0x4fa038 CoSetProxyBlanket   : seguramente busca configurar la manta de seguridad que se aplica a los servidores proxy 

---------------------SRINGS-----------------------------------------------
- idata : Importa datos
SHLWAPI.dll ADVAPI32.dll   ??
ACTIVEDS.dll ole32.dll     ??

- \Registry\Machine\Software\Classes\Lockbit
- \Registry\Machine\Software\Classes\Lockbit\shell\Open\Command

- Elevation:Administrator!new: ---> Busca elevar privilegios

NOTA DE RESCATE : 
All your files stolen and encrypted
for more information see
RESTORE-MY-FILES.TXT
that is located in every encrypted folder.
Would you like to earn millions of dollars?
Our company acquire access to networks of various companies, as well as insider information that can help you steal the most valuable data of any company.
You can provide us accounting data for the access to any company, for example, login and password to RDP, VPN, corporate email, etc. Open our letter at your email. Launch the provided virus on any computer in your company.
Companies pay us the foreclosure for the decryption of files and prevention of data leak.
You can communicate with us through the Tox messenger
https://tox.chat/download.html
Using Tox messenger, we will never know your real name, it means your privacy is guaranteed.
If you want to contact us, use ToxID: 3085B89A0C515D2FB124D645906F5D3DA5CB97CEBEA975959AE4F95302A04E1D709C3C4AE9B7
If this contact is expired, and we do not respond you, look for the relevant contact data on our website via Tor or Brave Browser
http://lockbitapt6vx57t3eeqjofwgcglmutr3a35nygvokja5uuccip4ykyd.onion
https://bigblog.at

INHABILITA ANTIVIRUS: 

[Software\Policies\Microsoft\Windows Defender
;DisableAntiSpyware

][Software\Policies\Microsoft\Windows Defender\Real-Time Protection
;DisableRealtimeMonitoring

][Software\Policies\Microsoft\Windows Defender\Spynet
;SubmitSamplesConsent

][Software\Policies\Microsoft\Windows Defender\Threats
;Threats_ThreatSeverityDefaultAction

-------------

\Registry\Machine\Software\Classes\Lockbit\shell\Open\Command
"C:\Windows\system32\mshta.exe" "%s"  ---------> EJECUTABLE?

--------------------------------MITRE------------------------------------
T1057 - Descubre procedimientos -> Enumera e insiste en procesos
T1059 - Comandos y scripts -> bcdedit_command ->  herramienta para editar la configuración de arranque de Windows Vista y versiones posteriores de Windows
T1070 - Borra logs 
T1112 - Modifica registros -> persistencia (autorun)
T1202 - Ejecución de comandos indirectos -> seguramente para eludir restricciones de seguridad al momento de ejecutar comandos-> usa utilidades de windows
T1564 - Esconde artefactos -> seguramente para ejecutar cosas de forma oculta
T1071 - Conexiones de red 
T1074 - "Datos organizados" -> echando mano en la papelera
T1485 -Borra logs 
T1486 - Encripta datos -> los datos del ransomware
T1490 -Inhabilita la recuperación del sistema -> persistencia
T1547 - Persistencia a reinicio automatico

--------------------------------SIGNATURES------------------------------
1.Método antisandbox -> anti-debug
2.Método antisandbox por medio de los adaptadores de red
3.Detectado por una regla YARA -> 
Hit: PID 2108 trigged the Yara rule 'INDICATOR_SUSPICIOUS_GENRansomware'
4.Método antisandbox viendo la hora local 
5.Intenta conectarse a muchas IP muertas 510 veces
6.Importacion de librerias al momento de la ejecución 
7.Enumera procesos: 
conhost.exe -> el proceso de un programa (criptominero) que está diseñado para minar la criptomoneda Monero.
msiexec.exe -> Proporciona los medios para instalar, modificar y realizar operaciones en Windows Installer desde la línea de comandos.
dllhost.exe ->  está diseñado para forzar la apertura de páginas web no confiables, engañosos y maliciosos
 Rundll32.exe -> objetivo de hackers que buscan esconder varias infecciones de ordenador como spywares, keyloggers, troyanos y otras dentro del sistema
8.Expresa interes en ciertos procesos
9.Manipula datos de la papelera -> se da los permisos. Pasa por las siguientes rutas : 
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$I44QTP5.py
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$INB7KZ3.pub
file: C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\desktop.ini
10.Proceso en ventana oculta: 
87658a3c5cd72eddc1f3c52b.exe -> cmd.exe
borra backups, shadow copies
/c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no'
 '/c wevtutil cl system
11.Intenta esconderse del depurador
-ThreadHideFromDebugger --> cualquier excepción omitirá el depurador y presionará SEH o explotará y bloqueará la aplicación
12.Crea una memoriia RWX
13.Hace uso de las utilidades de windows:
borra los backups ->C:\Windows\System32\cmd.exe" /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no
cmd.exe /c vssadmin Delete Shadows /All /Quiet
cmd.exe /c wmic SHADOWCOPY /nointeractive
: bcdedit /set {default} bootstatuspolicy ignoreallfailures --> obligará al sistema a arrancar normalmente, en lugar de en el Entorno de recuperación de Windows

14.Modifica la configuración de boot (persistencia)
15.Se autoinstala para hacer autorun en el equipo (persistencia)
16.Regla yara que identifica el tipo de malware : Lockbit: [{'Yara': '87658a3c5cd72eddc1f3c52b489ed43e59a0d044c849f300e0f7537568e0502f'}]
17.Borra eventos y logs de Windows
18.Intenta borrar o modificar el volumen de las shadow copies
19.Crea instrucciones para desencriptar el ransomware "LockBIt"
20.Usa comandos maliciosos y utilidades de Windows
--------------------------------HOST--------------------------------
No detectados
--------------------------------DNS--------------------------------
No detectados 
----------------------------------------------------------------
Ficheros modificados:
A entrado a todas las aplicaciones robando los datos y dejando una nota de como restaurar los archivos
 C:\program files\microsoft games\FreeCell\es-ES\Restore-My-Files.txt
 C:\program files\microsoft games\Hearts\es-ES\Restore-My-Files.txt
 C:\program files\microsoft office\Office14\3082\Restore-My-Files.txt
 C:\program files\mozilla firefox\browser\features\Restore-My-Files.txt
 C:\program files\mozilla firefox\gmp-clearkey\0.1\Restore-My-Files.txt
 
 Desinstala explorador: 
 C:\program files\mozilla firefox\uninstall\uninstall.log
 Antisandbox revisando hora: 
  C:\program files\windows sidebar\Gadgets\clock.gadget\es-ES\js\timezones.js
  
 Bloquea aplicación--> C:\1FB940CD.lock
 -----------------------------Read Key Registers-----------------------
 
 HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\LDAP\UseHostnameAsAlias
DisableUserModeCallbackFilter
 HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\Windows\CurrentVersion\Policies\Explorer\NoPropertiesMyComputer
 
 
Manipulación de sfotware en su apartado de shellfolder---> KEY_LOCAL_MACHINE\SOFTWARE\Classes\Wow6432Node\CLSID\{9343812E-1C37-4A49-A12E-4B2D810D956B}\ShellFolder\RestrictedAttributes

 HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Wow6432Node\CLSID\{BD7A2E7B-21CB-41B2-A086-B309680C6B7E}\ShellFolder\HideOnDesktopPerUser
 
 HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Internet Explorer\MAIN\FeatureControl\FEATURE_LOCALMACHINE_LOCKDOWN\87658a3c5cd72eddc1f3c52b.exe
 
Permitiendo el paso a usuarios invitados no seguros(?) HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\LanmanWorkstation\NetworkProvider\name
HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\LanmanWorkstation\NetworkProvider\Class
HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\LanmanWorkstation\NetworkProvider\ProviderPath

INfo total acerca del explorer --->
 HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\explorer\FolderDescriptions\{C870044B-F49E-4126-A9C3-B52A1FF411E8}\Security
 
 
 HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\Internet Explorer\MAIN\FeatureControl\FEATURE_MIME_HANDLING\WMIC.exe
 HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\Internet Explorer\MAIN\FeatureControl\FEATURE_HTTP_USERNAME_PASSWORD_DISABLE\*
 
 Persistencia(?)---> HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\SystemStartOptions
--------------------------Archivos que ha accedido----------------------
 lugar del virus---> C:\Users\ama\AppData\Local\Temp\87658a3c5cd72eddc1f3c52b.exe.Local\
 
 Bloquea este archivo---> C:\1FB940CD.lock
 Mira las zonas de seguridad del sistema --> C:\Windows\sysnative\cmd.exe:Zone.Identifier
 
 
 Desinstala explorador--> C:\program files\mozilla firefox\uninstall\*
C:\program files\mozilla firefox\uninstall\uninstall.log


un archivo ejecutable en el disco duro de tu ordenador. El archivo contiene un código máquina.--> C:\Program Files\Common Files\Microsoft Shared\OFFICE14\MSOXMLMF.DLL

Método anti-sandbox, revisando hora-->
 C:\Windows\sysnative\cmd.exe:Zone.Identifier
 
Ejecutables:
 C:\Windows\sysnative\wbem\WMIC.exe.Local\
 C:\Windows\sysnative\bcdedit.exe 
 C:\Windows\sysnative\vssadmin.exe
 
 Extraño -->  C:\Program Files\Common Files\Microsoft Shared\OFFICE14\MSOXMLMF.DLL
 

 
--------------------------ARCHIVOS ELIMINADOS---------------------------
 
 C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$R44QTP5.py
C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$I44QTP5.py
C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$RNB7KZ3.pub
C:\$Recycle.Bin\S-1-5-21-2225935160-554833140-588599421-1000\$INB7KZ3.pub

--------------------------Modified Registry Keys------------------------

Persistencia--> 
 HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\{18B9B5CD-5757-9DC4-05A1-05E5D2E7E1AC}

(?) --> HKEY_CURRENT_USER\SOFTWARE\1FB940CD57E8A1

conexiones -->  HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\UNCAsIntranet
 HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\AutoDetect
 
-------------------------Eliminación de registros Keys------------------

ELiminación de proxys:
 HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProxyBypass
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProxyBypass

Intranet manipulación: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\IntranetName
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\IntranetName

Seguridad--> bcdedit /set {default} bootstatuspolicy ignoreallfailures
-------------------------ComandosEjecutados-------------------------
Borra backups + persistencia -->
 "C:\Windows\System32\cmd.exe" /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no
 
 -------------------------MUTEXES-------------------------
  \BaseNamedObjects\{E95740CD-E957-9DE8-05A1-B1E5E5E7B1AC}
Local\ZoneAttributeCacheCounterMutex
Local\ZonesCacheCounterMutex
Local\ZonesLockedCacheCounterMutex

------------------------Arbol------------------------------------

-87658a3c5cd72eddc1f3c52b.exe 2512
 -cmd.exe 2108 "C:\Windows\System32\cmd.exe" /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no
      -vssadmin.exe 2724 vssadmin delete shadows /all /quiet
      -WMIC.exe 1740 wmic shadowcopy delete
      -bcdedit.exe 1508 bcdedit /set {default} bootstatuspolicy ignoreallfailures
      -bcdedit.exe 1532 bcdedit /set {default} recoveryenabled no
      
------------------------------------TCP---------------------------------
192.168.122.6   --->  	192.168.122.1 
---------------------------------UDP-------------------------------------
51.137.137.111 
239.255.255.250 
192.168.122.255 
224.0.0.252 ----> VIRUSTOTAL--> mencionado en colecciones
192.168.122.6 

-----------------------------DROPPED-FILES-------------------------------
NOMBRE: $INB7KZ3.pub
FILE TYPE: data
MD5: 45d45cc2c1a24df95f888d2a827e6915
SHA1: 3e0f08a56faa097ae9a0a59eb4ae0b3e63c54a94
SHA256: 37a911747236dfbcdfd1f8d61c00adfb98f17c283c72edfa59c40005de9e9047

.................................

NOMBRE:$RNB7KZ3.pub
FILE TYPE: Composite Document File V2 Document,
MD5: 0627b4727e2bfe1d1cb7f06b82bfcc5c
SHA1: 7399b9e033ded0ee565bd3de299b4d9d2f46d769
SHA256:  	e050ea777d910137fff7c160992ec026ab4f76832b6c96701b114e379abf4ca3

.................................

NOMBRE:$I44QTP5.py
FILE TYPE: data
MD5: cbf25f066a1ce16a26174081d9bf7b61
SHA1: 4101008f308b0c677acd263641c022e311912bec
SHA256: d1cb6c1c4328c4dadb21b1f39623362cadb060929f0ea92d58fb1cce561c5f68

.................................

NOMBRE: Restore-My-Files.txt
FILE TYPE: ASCII text, with CRLF line terminators
MD5: 2d4b35c109f4c6a525d98a4b6de57a3b
SHA1: 96746354be008668c1ea83ea117a949a122cd952
SHA256: 7bb2a6c676c223da65588a79b893e3bf3a851d418f59c13b6786545eb91ff50b 

.................................


NOMBRE:  $R44QTP5.py
FILE TYPE: Python script, ASCII text executable
MD5:29197927e00d0dce84d0c357394123df
SHA1: 90f3cc0e5ed7393171a91fc86c0c00f1ceaf1f2d
SHA256:  	d7b7bc36ec310f9d9e152e0452ffd8a742b56e25153ef7a978368f0d186fa3e5

-------------------------------PROCESOS-------------------------------

NOMBRE:  	
922573798226bb3edd57e1af161ab56f8dc51462f35e17faef4ac98142819b33

TIPO:PE32+ executable (console) x86-64, for MS Windows
SHA256:922573798226bb3edd57e1af161ab56f8dc51462f35e17faef4ac98142819b33
MD5:c9f6b2ac293d540d56158926bff75574
YARA: INDICATOR_SUSPICIOUS_GENRansomware - detects command variations typically used by ransomware - Author: ditekSHen 

..............

NOMBRE:edec31f3d36bb4b2e96de3c363fc6b2b4479962aecd843c76cc413a8310c4416
TIPO:PE32+ executable (console) x86-64, for MS Windows
MD5:0138aeea551a8bee52167387faa070eb
SHA256:edec31f3d36bb4b2e96de3c363fc6b2b4479962aecd843c76cc413a8310c4416

..............
NOMBRE:950781a0884345f16ced7342cb4b146f681c76fbf5919ed4cdc04403a8a6ced4
TIPO:PE32+ executable (console) x86-64, for MS Windows
MD5:df479dd363cd59894514dfd12ac1aa65
SHA256:950781a0884345f16ced7342cb4b146f681c76fbf5919ed4cdc04403a8a6ced4 

..............

NOMBRE:748304b396b9536472297d1ad76f0d82d49752bdc2aad8dd3e779e7806baa3ed
TIPO:PE32+ executable (console) x86-64, for MS Windows
MD5:29c6ebbcc3b1b5413c05be9d8f7983e9
SHA256:748304b396b9536472297d1ad76f0d82d49752bdc2aad8dd3e779e7806baa3ed

..............

NOMBRE:3841133b6c0481c4c1924112693266655b862e8a80db52b1a1f2859c82c6536a
TIPO:PE32+ executable (console) x86-64, for MS Windows
MD5:37af431ef94f7b5128c3b7fc086b71f5
SHA256: 	3841133b6c0481c4c1924112693266655b862e8a80db52b1a1f2859c82c6536a



